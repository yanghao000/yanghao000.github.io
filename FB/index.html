<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>index</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,maximum-scale=1"/>
		<link rel="stylesheet" href="css/iconfont.css" />
		<link rel="stylesheet" href="css/com.css" />
		<script src="js/jquery-1.12.0.js"></script>
		<script src="js/swiper.min.js"></script>
		<script src="js/iscroll.js"></script>
		<script src="js/ajax.js"></script>
		<script src="js/localStorage.js"></script>
		<style>
			.title p:nth-child(1){background: #79c1df;}
			.title p:nth-child(2){color:#b1e4f8;}
			html,body{height:100%;}
			body{background: #f1f1f1;}
			.contIndex{overflow: hidden;padding-top:0.1rem;position: relative;}
			.contBox{background: #fff;width:3.1rem; position: absolute;overflow: hidden;}
			.contBox img{width:3.1rem;height:3.1rem;display: block;}
			.contBox:nth-child(even){}
			.contBox p{padding:0.1rem 0.2rem; line-height:0.4rem;font-size: 0.28rem;color:#333;}
			/*.indexSlideC,.indexSlideR{display: none;}*/
			.user{padding:0.2rem;background: #fff;overflow: hidden;}
			.headPhoto{width:0.95rem;height:0.95rem;float: left;margin-right:0.2rem;}
			.headPhoto img{width:0.95rem;height:0.95rem; display: block;}
			.userInfor{width:4.8rem;min-height:0.95rem;height:auto;float: left;position: relative;}
			.userName{font-size: 0.28rem;color:#000;position: absolute;top:0.05rem;left:0;}
			.sign{font-size: 0.24rem;color:#999;margin-top:0.56rem;}
			.zan{font-size:0.24rem;color:#999;height:0.34rem;position: absolute;top:0.05rem;right:0;}
			.zan img{float:left;width:0.24rem;height:0.23rem;margin-top:0.05rem;}
			.zan p{float:left;margin-right:0.1rem;}
			.contIndexBig{overflow: hidden;}
			.contBoxBig{background: #fff;width:6.4rem;margin-bottom:0.1rem;}
			.contBoxBig img{width:6.4rem;height:6.4rem;display: block;}
			.contBoxBig p{padding:0.14rem 0.2rem; line-height:0.4rem;font-size: 0.28rem;color:#333;}
			.focus{display: none;}
			.indexSlide{background: #f1f1f1;}
			
			/*#iScrollLOut{overflow-y:auto;}*/
			.swiper-container{position: relative;}
			#preloader_1{position: absolute;left:0;right:0;top:0;bottom:0;margin:auto;width:50px;height:1px;}
		</style>
	</head>
	<body>
		<header class="header">
			<div class="title">
				<p>热点</p>
				<p>关注</p>
			</div>
		</header>
		<div class="hot">
			<nav class="nav">
				<ul>
					<li class="active">足球现场</li>
					<li>足球生活</li>
					<li>足球美女</li>
				</ul>
			</nav>
			<div class="swiper-container" >
				<div id="preloader_1">
				   <span></span>
				   <span></span>
				   <span></span>
				   <span></span>
				   <span></span>
				</div>
				<div class="swiper-wrapper">
					<div class="swiper-slide">
						<div id="iScrollLOut">
							<div id="iScrollLIn">
								<div class="indexSlide indexSlideL">
									<section class="contIndex">
										<!--<div class="contBox">
											<img src="img/contBoxImg.jpg"/>
											<p>蜡笔小新！蜡笔小新新新！！！！</p>
										</div>-->
									</section>
								</div>
							</div>
						</div>
					</div>
					<div class="swiper-slide">
						<div id="iScrollCOut">
							<div id="iScrollCIn">
								<div class="indexSlide indexSlideC">
									<section class="contIndex">
										
									</section>
								</div>
							</div>
						</div>
					</div>
					<div class="swiper-slide">
						<div id="iScrollROut">
							<div id="iScrollRIn">
								<div class="indexSlide indexSlideR">
									<section class="contIndex">
										
									</section>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
				
		</div><!--hot-->
		
		<div class="focus">
			<div class="focusIn">
				<div id="focusScrollOut">
					<div id="focusScrollIn">
						<div class="contIndexBig">
							<div class="user">
								<div class="headPhoto"><a href=""><img src="img/headPhoto.png"/></a></div>
								<div class="userInfor">
									<div class="userName">我叫小强</div>
									<div class="zan"><p>32222</p><img src="img/zan.png"/></div>
									<div class="sign">我是小强我怕谁!呵呵呵！！撒的发违法发阿文范文芳撒的发</div>
								</div>
							</div>
							<div class="contBoxBig">
								<img src="img/contBoxImg.jpg"/>
								<p>蜡笔小新！蜡笔小新新新！！！！</p>
							</div>
						</div>
						<div class="contIndexBig">
							<div class="user">
								<div class="headPhoto"><a href=""><img src="img/headPhoto.png"/></a></div>
								<div class="userInfor">
									<div class="userName">我叫小强</div>
									<div class="zan"><p>32222</p><img src="img/zan.png"/></div>
									<div class="sign">我是小强我怕谁!呵呵呵！！</div>
								</div>
							</div>
							<div class="contBoxBig">
								<img src="img/contBoxImg.jpg"/>
								<p>蜡笔小新！蜡笔小新新新！！！！</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<footer class="footer">
			<ul>
				<a href="index.html"><li><i class="iconfont active">&#xe689;</i><p class="active">首页</p></li></a>
				<a href="find.html"><li><i class="iconfont">&#xe662;</i><p>发现</p></li></a>
				<li><i class="iconfont">&#xe669;</i><div></div></li>
				<a href="self.html"><li><i class="iconfont">&#xe6bc;</i><p>我的</p></li></a>
				<a href="login.html"><li><i class="iconfont">&#xe638;</i><p>退出</p></li></a>
			</ul>
		</footer>
		<script>
var hotLobj = null;
var hotCobj = null;
var hotRobj = null;
var focusObj = null;
var mySwiper = null;	
var loadingHei;
$(function(){
	headToggle();
	newSwiper();
	swiperHei();
	navClick();
	proLoading($("#iScrollLIn"));
	loadingHei = $(".spinnerOut").outerHeight(true);
	hotScrollL();
	ajax("1",".contIndex:eq(0)");
});	

function ajax(ind,obj){
	if(flag){
	flag = 0;
	indexAjax({category:ind},function(data){
		var t = setTimeout(function(){
			var list = data.data.tweetlist;
			for(var i=0; i<parseInt(list.length/3); i++){
				var img = "http://101.200.173.217:8080/FootBall"+list[i].defaultFilePath+list[i].thumbnailname;
				var cont = list[i].content;
				$(
					'<div class="contBox">'+
						'<img src='+img+'>'+
						'<p>'+cont+'</p>'+
					'</div>'
				).appendTo(obj);
			}
			wall($(".contIndex").eq(ind-1)[0]);
			changeSize(ind-1);
			showLoading();
			switch(ind){
				case"1": hotLobj.refresh();hotLobj.maxScrollY = hotLobj.maxScrollY + loadingHei;
				break;
				case"2": hotCobj.refresh();hotCobj.maxScrollY = hotCobj.maxScrollY + loadingHei;
				break;
				case"3": hotRobj.refresh();hotRobj.maxScrollY = hotRobj.maxScrollY + loadingHei;
				break;
			}
			flag = 1;
		},1000);
	});
	}else{
		return false;
	}
}

function proLoading(selector){
	loadingFind(selector,"下拉刷新","before");
	loadingFind(selector,"上拉加载","after");
}

//   创建swiper
function newSwiper(){
	mySwiper = new Swiper('.swiper-container', {
//		   autoHeight: true, 
		   onSlideChangeEnd:function(){
		   	console.log(mySwiper.activeIndex);
			navActive(mySwiper.activeIndex);
	   },
   });
}
function swiperHei(){
	var bodyHei = $("body").height();
    var headerHei = $(".header").height();
    var navHei = $(".nav").height();
    var footerHei = $(".footer").outerHeight(true);
    var searchHei = $(".search").outerHeight(true);
    var bodyWid = $("body").width();
    $(".swiper-container").css({"height":bodyHei-headerHei-navHei-footerHei,"overflow":"hidden"});
    $(".swiper-wrapper").css({"width":bodyWid*3,"height":"100%"});
    $(".swiper-slide").css({"float":"left"}); 
    $("#iScrollLOut").css({"height":bodyHei-headerHei-navHei-footerHei});
    $("#iScrollCOut").css({"height":bodyHei-headerHei-navHei-footerHei});
    $("#iScrollROut").css({"height":bodyHei-headerHei-navHei-footerHei});
    $("#focusScrollOut").css({"height":bodyHei-headerHei-footerHei});
}


function hotScrollL(){
	var loadingHei = $(".spinnerOut").outerHeight(true);
	var up = $(".spinnerOut").eq(0);
	var down = $(".spinnerOut").eq(1);
	
	function upActive(){
		ajax("1",".contIndex:eq(0)");
	}
	function downActive(){
		ajax("1",".contIndex:eq(0)");
	}
	
	hotLobj = new iScroll("iScrollLOut",{
		topOffset: loadingHei,
		vScrollbar: true,
		onRefresh: function () {
			if (up.hasClass("loading")) {
//				this.maxScrollY = this.maxScrollY + loadingHei;
				up.removeClass("loading flip");
				up.find("p").html("下拉刷新");
			}
			if (down.hasClass("loading")) {
//				this.maxScrollY = this.maxScrollY + loadingHei;
				down.removeClass("loading flip");
				down.find("p").html("上拉加载");
			}
		},
		onScrollMove: function () {
			if (this.y > 60 && !up[0].className.match('flip')) {	
				this.minScrollY = 0;
				up.find("p").html("释放刷新");
				up.addClass("flip");
			}else if(this.y < 40 && up[0].className.match('flip')){
				this.minScrollY = -loadingHei;
				up.find("p").html("下拉刷新");
				up.removeClass("flip");
			}else if(this.y < (this.maxScrollY-90) && !down[0].className.match('flip')){
				this.maxScrollY = this.maxScrollY - loadingHei;
				down.find("p").html("释放加载");
				down.addClass("flip");
			}else if(this.y > (this.maxScrollY-60) && down[0].className.match('flip')){
				this.maxScrollY = this.maxScrollY + loadingHei;
				down.find("p").html("上拉加载");
				down.removeClass("flip");
			}
		},
		onScrollEnd: function () {
			if(up[0].className.match('flip')){
				up.addClass("loading");
				up.find("p").html("正在刷新");
				upActive();
			}else if(down[0].className.match('flip')){
				down.addClass("loading");
				down.find("p").html("正在加载");
				downActive();
			}
		}
	});
//	hotLobj.maxScrollY = hotLobj.maxScrollY + loadingHei;
//	setTimeout(function(){
//		hotLobj.refresh();
//		hotLobj.maxScrollY = hotLobj.maxScrollY + loadingHei;
//	},10);
}

function hotScrollC(){
	var loadingHei = $(".spinnerOut").outerHeight(true);
	var up = $(".spinnerOut").eq(2);
	var down = $(".spinnerOut").eq(3);
	
	function upActive(){
		ajax("2",".contIndex:eq(1)");
	}
	function downActive(){
		ajax("2",".contIndex:eq(1)");
	}
	
	hotCobj = new iScroll("iScrollCOut",{
		topOffset: loadingHei,
		onRefresh: function () {
			if (up.hasClass("loading")) {
//				this.maxScrollY = this.maxScrollY + loadingHei;
				up.removeClass("loading flip");
				up.find("p").html("下拉刷新");
			}
			if (down.hasClass("loading")) {
//				this.maxScrollY = this.maxScrollY + loadingHei;
				down.removeClass("loading flip");
				down.find("p").html("上拉加载");
			}
		},
		onScrollMove: function () {
			if (this.y > 60 && !up[0].className.match('flip')) {	
				this.minScrollY = 0;
				up.find("p").html("释放刷新");
				up.addClass("flip");
			}else if(this.y < 40 && up[0].className.match('flip')){
				this.minScrollY = -loadingHei;
				up.find("p").html("下拉刷新");
				up.removeClass("flip");
			}else if(this.y < (this.maxScrollY-90) && !down[0].className.match('flip')){
				this.maxScrollY = this.maxScrollY - loadingHei;
				down.find("p").html("释放加载");
				down.addClass("flip");
			}else if(this.y > (this.maxScrollY-60) && down[0].className.match('flip')){
				this.maxScrollY = this.maxScrollY + loadingHei;
				down.find("p").html("上拉加载");
				down.removeClass("flip");
			}
		},
		onScrollEnd: function () {
			if(up[0].className.match('flip')){
				up.addClass("loading");
				up.find("p").html("正在刷新");
				upActive();
			}else if(down[0].className.match('flip')){
				down.addClass("loading");
				down.find("p").html("正在加载");
				downActive();
			}
		}
	});
//	hotCobj.maxScrollY = hotCobj.maxScrollY + loadingHei;
}

function hotScrollR(){
	var loadingHei = $(".spinnerOut").outerHeight(true);
	var up = $(".spinnerOut").eq(4);
	var down = $(".spinnerOut").eq(5);
	
	function upActive(){
		ajax("3",".contIndex:eq(2)");
	}
	function downActive(){
		ajax("3",".contIndex:eq(2)");
	}
	
	hotRobj = new iScroll("iScrollROut",{
		topOffset: loadingHei,
		onRefresh: function () {
			if (up.hasClass("loading")) {
//				this.maxScrollY = this.maxScrollY + loadingHei;
				up.removeClass("loading flip");
				up.find("p").html("下拉刷新");
			}
			if (down.hasClass("loading")) {
//				this.maxScrollY = this.maxScrollY + loadingHei;
				down.removeClass("loading flip");
				down.find("p").html("上拉加载");
			}
		},
		onScrollMove: function () {
			if (this.y > 60 && !up[0].className.match('flip')) {	
				this.minScrollY = 0;
				up.find("p").html("释放刷新");
				up.addClass("flip");
			}else if(this.y < 40 && up[0].className.match('flip')){
				this.minScrollY = -loadingHei;
				up.find("p").html("下拉刷新");
				up.removeClass("flip");
			}else if(this.y < (this.maxScrollY-90) && !down[0].className.match('flip')){
				this.maxScrollY = this.maxScrollY - loadingHei;
				down.find("p").html("释放加载");
				down.addClass("flip");
			}else if(this.y > (this.maxScrollY-60) && down[0].className.match('flip')){
				this.maxScrollY = this.maxScrollY + loadingHei;
				down.find("p").html("上拉加载");
				down.removeClass("flip");
			}
		},
		onScrollEnd: function () {
			if(up[0].className.match('flip')){
				up.addClass("loading");
				up.find("p").html("正在刷新");
				upActive();
			}else if(down[0].className.match('flip')){
				down.addClass("loading");
				down.find("p").html("正在加载");
				downActive();
			}
		}
	});
//	hotRobj.maxScrollY = hotRobj.maxScrollY + loadingHei;
}

//窗口改变
function changeSize(i){
	window.onresize = function(){
		swiperHei();
		wall($(".contIndex").eq(i)[0]);
		if(i == 0){
			hotLobj.refresh();hotLobj.maxScrollY = hotLobj.maxScrollY + loadingHei;
		}
		if(i == 1){
			hotCobj.refresh();hotCobj.maxScrollY = hotCobj.maxScrollY + loadingHei;
		}
		if(i == 2){
			hotRobj.refresh();hotRobj.maxScrollY = hotRobj.maxScrollY + loadingHei;
		}
	}
}

//导航点击切换
function navClick(){
//	removeLoading();
	$(".nav li").on("click",function(){
		var i = $(this).index();
		mySwiper.slideTo(i,500,false);
		$(this).addClass("active").siblings().removeClass("active");
		if($(".indexSlideL .contIndex").height()<15){
			console.log(1);
			proLoading($("#iScrollLIn"));
			hotScrollL();
			ajax("1",$(".contIndex:eq(0)"));
		}else if($(".indexSlideC .contIndex").height()<15){
			console.log(2);
			proLoading($("#iScrollCIn"));
			hotScrollC();
			ajax("2",$(".contIndex:eq(1)"));
		}else if($(".indexSlideR .contIndex").height()<15){
			console.log(3);
			proLoading($("#iScrollRIn"));
			hotScrollR();
			ajax("3",$(".contIndex:eq(2)"));
		}else{
			console.log(4);
			swiperHei();
			wall($(".contIndex").eq(i)[0]);
			changeSize(i);
		}
	});
};
//导航选择状态
function navActive(i){
	$(".nav li").eq(i).addClass("active").siblings().removeClass("active");
		if($(".indexSlideL .contIndex").height()<15&&i==0){
			console.log(1);
			proLoading($("#iScrollLIn"));
			hotScrollL();
			ajax("1",$(".contIndex:eq(0)"));
		}else if($(".indexSlideC .contIndex").height()<15&&i==1){
			console.log(2);
			proLoading($("#iScrollCIn"));
			hotScrollC();
			ajax("2",$(".contIndex:eq(1)"));
		}else if($(".indexSlideR .contIndex").height()<15&&i==2){
			console.log(3);
			proLoading($("#iScrollRIn"));
			hotScrollR();
			ajax("3",$(".contIndex:eq(2)"));
		}else{
			console.log(4);
			swiperHei();
			wall($(".contIndex").eq(i)[0]);
			changeSize(i);
		}
	}
//头部切换
var focusFlag = 1;
function headToggle(){
	$(".title p").click(function(){
		if($(this).index()==0){
			$(".focus").hide();
			$(".hot").show();
			$(this).css({"background":" #79c1df","color":"#fff"});
			$(this).siblings().css({"background":" #57b2d7","color":"#b1e4f8"});
		}else{
			if(focusFlag){
				focusFlag = 0;
				focusScroll();
			}
			$(".focus").show();
			$(".hot").hide();
			$(this).css({"background":" #79c1df","color":"#fff"});
			$(this).siblings().css({"background":" #57b2d7","color":"#b1e4f8"});
		}
	});
}

function focusScroll(){
	swiperHei();
	proLoading($("#focusScrollIn"));
	
	var loadingHei = 35;
	var up = $("#focusScrollIn .spinnerOut").eq(0);
	var down = $("#focusScrollIn .spinnerOut").eq(1);
	
	function upActive(){
//		ajax("1",".contIndex:eq(0)");
		setTimeout(function(){
			focusObj.refresh();
		},100);
	}
	function downActive(){
//		ajax("1",".contIndex:eq(0)");
		setTimeout(function(){
			focusObj.refresh();
		},100);
	}
	
	focusObj = new iScroll("focusScrollOut",{
		topOffset: loadingHei,
		onRefresh: function () {
			if (up.hasClass("loading")) {
//				this.maxScrollY = this.maxScrollY + loadingHei;
				up.removeClass("loading flip");
				up.find("p").html("下拉刷新");
			}
			if (down.hasClass("loading")) {
//				this.maxScrollY = this.maxScrollY + loadingHei;
				down.removeClass("loading flip");
				down.find("p").html("上拉加载");
			}
		},
		onScrollMove: function () {
			if (this.y > 60 && !up[0].className.match('flip')) {	
				this.minScrollY = 0;
				up.find("p").html("释放刷新");
				up.addClass("flip");
			}else if(this.y < 40 && up[0].className.match('flip')){
				this.minScrollY = -loadingHei;
				up.find("p").html("下拉刷新");
				up.removeClass("flip");
			}else if(this.y < (this.maxScrollY-90) && !down[0].className.match('flip')){
				this.maxScrollY = this.maxScrollY - loadingHei;
				down.find("p").html("释放加载");
				down.addClass("flip");
			}else if(this.y > (this.maxScrollY-60) && down[0].className.match('flip')){
				this.maxScrollY = this.maxScrollY + loadingHei;
				down.find("p").html("上拉加载");
				down.removeClass("flip");
			}
		},
		onScrollEnd: function () {
			if(up[0].className.match('flip')){
				up.addClass("loading");
				up.find("p").html("正在刷新");
				upActive();
			}else if(down[0].className.match('flip')){
				down.addClass("loading");
				down.find("p").html("正在加载");
				downActive();
			}
		}
	});
//	focusObj.maxScrollY = focusObj.maxScrollY + loadingHei;
	showLoading();
	setTimeout(function(){
		focusObj.refresh();
		focusObj.maxScrollY = focusObj.maxScrollY + loadingHei;
	},10);
}

		</script>
	</body>
</html>
